<!DOCTYPE html>
<html>

<head>
    <title>Uma Rooma Tracker</title>
    <style>
        html, body {
            margin: 0;
            padding: 0;
            font-family: "Segoe UI", Arial, sans-serif;
            background: #f9f9fb;
            color: #333;
        }

        header {
            background: linear-gradient(90deg, #000000, #3d3d3d);
            color: #fff;
            padding: 16px 20px;
            font-size: 1.4em;
            font-weight: bold;
        }

        .container {
            max-width: 900px;
            margin: auto;
            padding: 20px;
        }

        .section {
            background: white;
            padding: 20px;
            margin-bottom: 20px;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.04);
        }

        h2 {
            margin-top: 0;
            color: #444;
        }

        input[type=file],
        input[type=date] {
            margin-top: 10px;
            margin-bottom: 10px;
            display: block;
            font-size: 0.95em;
            padding: 8px;
            border: 1px solid #ccc;
            border-radius: 4px;
        }

        button {
            padding: 10px 18px;
            background: #945ec2;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.95em;
        }

        button:hover {
            background: #6f4396;
        }

        table {
            border-collapse: collapse;
            width: 100%;
            margin-top: 10px;
            font-size: 0.9em;
        }

        th, td {
            padding: 10px;
            border: 1px solid #e0e0e0;
            text-align: right;
        }

        th {
            background: #f4f4f6;
            font-weight: 500;
        }

        td:first-child,
        th:first-child {
            text-align: left;
        }
    </style>
</head>

<body>
    <header>Uma Rooma Fan Tracker</header>

    <div class="container">
        <!-- Upload Section -->
        <div class="section">
            <h2>Upload JSON</h2>
            <input type="file" id="jsonFile" accept=".json">
            <button onclick="uploadJSON()">Upload</button>
            <p id="uploadStatus"></p>
        </div>

        <!-- View Changes Section -->
        <div class="section">
            <h2>View Changes</h2>
            <label>Select Date:</label>
            <input type="date" id="datePicker">
            <button onclick="fetchChanges()">Get Changes</button>
            <div id="changesContainer"></div>
        </div>

    <script>
        // Change to your deployed Apps Script web app URL
        const WEB_APP_URL = "https://script.google.com/macros/s/AKfycbw5WX9OQ9AjPxMuF22_X90v0JjwBtKL8WAjIZhvKfO_Y5EK4VSFAsb1lyDWi6mUSbC2Mw/exec";

        async function uploadJSON() {
            const fileInput = document.getElementById('jsonFile');
            const statusEl = document.getElementById('uploadStatus');

            if (!fileInput.files.length) {
                statusEl.textContent = "Please select a JSON file first.";
                return;
            }

            const file = fileInput.files[0];
            const text = await file.text();

            try {
                const response = await fetch(WEB_APP_URL, {
                    method: "POST",
                    contentType: "application/json",
                    body: text
                });

                const result = await response.json();
                if (result.status === "success") {
                    statusEl.textContent = "Upload successful!";
                    statusEl.style.color = "green";
                } else {
                    statusEl.textContent = "Upload failed: " + result.message;
                    statusEl.style.color = "red";
                }
            } catch (err) {
                statusEl.textContent = "Error uploading: " + err;
                statusEl.style.color = "red";
            }
        }

        async function fetchChanges() {
            const dateValue = document.getElementById('datePicker').value;
            if (!dateValue) {
                alert("Please select a date.");
                return;
            }

            try {
                const response = await fetch(`${WEB_APP_URL}?date=${encodeURIComponent(dateValue)}`);
                const result = await response.json();

                if (result.status !== "success") {
                    alert("Error: " + result.message);
                    return;
                }

                // Clear old table
                const container = document.getElementById("changesContainer");
                container.innerHTML = "";

                const tableData = result.data;
                if (!tableData || tableData.length === 0) {
                    container.innerHTML = "<p>No data found for this date.</p>";
                    return;
                }

                const table = document.createElement("table");

                // Add headers
                const headerRow = document.createElement("tr");
                tableData[0].forEach(header => {
                    const th = document.createElement("th");
                    th.textContent = header;
                    headerRow.appendChild(th);
                });
                table.appendChild(headerRow);

                // Add rows
                for (let i = 1; i < tableData.length; i++) {
                    const tr = document.createElement("tr");
                    tableData[i].forEach(cell => {
                        const td = document.createElement("td");
                        td.textContent = cell;
                        tr.appendChild(td);
                    });
                    table.appendChild(tr);
                }

                container.appendChild(table);

            } catch (err) {
                alert("Error fetching changes: " + err);
            }
        }
    </script>

</body>

</html>
