<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Uma Rooma Fan Tracker</title>
<style>
  body {
    font-family: Arial, sans-serif;
    background: #fafafa;
    margin: 0;
    padding: 0;
  }
  header {
    padding: 1rem;
    text-align: center;
    background: #333;
    color: white;
  }
  main {
    display: flex;
    flex-direction: column;
    gap: 1rem;
    max-width: 800px;
    margin: auto;
    padding: 1rem;
  }
  .upload-box, .table-box {
    background: white;
    padding: 1rem;
    border-radius: 8px;
    box-shadow: 0 2px 5px rgba(0,0,0,0.1);
  }
  input[type=file], button {
    padding: 0.5rem;
  }
  table {
    width: 100%;
    border-collapse: collapse;
  }
  table th, table td {
    padding: 0.5rem;
    border-bottom: 1px solid #ddd;
    text-align: left;
  }
  table th {
    background: #f4f4f4;
  }
</style>
</head>
<body>
<header>
  <h1>Uma Rooma Fan Tracker</h1>
</header>
<main>
  <div class="upload-box">
    <h3>Upload Daily JSON File</h3>
    <input type="file" id="jsonFile">
    <button onclick="uploadData()">Upload</button>
  </div>

  <div class="table-box">
    <h3>Player Data</h3>
    <table id="playerTable">
      <thead>
        <tr><th>Username</th><th>FanCount</th><th>ScanDate</th></tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>
</main>

<script>
const API_URL = "https://script.google.com/macros/s/AKfycbxBPYYrz7zqQvWzuA5fbdaR6Eu2qODoXE8gZilQdtnT2tnj9dKj8N_r_For441OkPZt3g/exec";

// Fetch data on load
document.addEventListener("DOMContentLoaded", loadData);

function loadData() {
  fetch(API_URL)
    .then(res => res.json())
    .then(data => {
      const tbody = document.querySelector("#playerTable tbody");
      tbody.innerHTML = "";
      data.forEach(row => {
        let tr = document.createElement("tr");
        tr.innerHTML = `<td>${row.Username}</td><td>${row.FanCount}</td><td>${row.ScanDate}</td>`;
        tbody.appendChild(tr);
      });
    });
}

function uploadData() {
  const fileInput = document.getElementById("jsonFile");
  if (!fileInput.files.length) {
    alert("Please select a JSON file first.");
    return;
  }
  const reader = new FileReader();
  reader.onload = function(e) {
    const jsonData = JSON.parse(e.target.result);
    fetch(API_URL, {
      method: "POST",
      body: JSON.stringify(jsonData)
    })
    .then(res => res.json())
    .then(resp => {
      alert("Data uploaded successfully!");
      loadData();
    })
    .catch(err => alert("Error uploading data: " + err));
  };
  reader.readAsText(fileInput.files[0]);
}
</script>
</body>
</html>
